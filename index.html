<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ANN BERRY MARCUS - æ‰‹åŠ¿äº¤äº’ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        #input_video { display: none; }
        #status { 
            position: absolute; top: 20px; left: 20px; 
            color: #00ffcc; font-family: monospace; z-index: 100;
            background: rgba(0,0,0,0.7); padding: 15px; border-radius: 5px;
            border: 1px solid #00ffcc;
        }
    </style>
</head>
<body>
    <div id="status">æ­£åœ¨åˆå§‹åŒ–ç³»ç»Ÿ... è¯·ç¡®ä¿å·²ç‚¹å‡»åœ°å€æ æ—è¾¹çš„â€œå…è®¸æ‘„åƒå¤´â€</div>
    <video id="input_video" playsinline></video>
    <canvas id="output_canvas"></canvas>

<script>
const videoElement = document.getElementById('input_video');
const canvas = document.getElementById('output_canvas');
const ctx = canvas.getContext('2d', { willReadFrequently: true });
const status = document.getElementById('status');

const names = ["ANN", "BERRY", "MARCUS"];
let width, height;
let rotationY = 0;
let targetRotationY = 0;
let hue = 0;

function resize() {
    width = canvas.width = window.innerWidth;
    height = canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// --- é¼ æ ‡å…œåº•æ–¹æ¡ˆ ---
window.addEventListener('mousemove', (e) => {
    // å¦‚æœæ‘„åƒå¤´æ²¡åŠ¨ï¼Œé¼ æ ‡ä¹Ÿèƒ½æ§åˆ¶
    if (!videoActive) {
        targetRotationY = (e.clientX / width - 0.5) * Math.PI * 1.5;
    }
});

let videoActive = false;

function onResults(results) {
    videoActive = true;
    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        status.innerText = "ğŸ™Œ å·²æ£€æµ‹åˆ°æ‰‹åŠ¿ï¼šå·¦å³ç§»åŠ¨æ—‹è½¬åå­—";
        const hand = results.multiHandLandmarks[0];
        const x = hand[8].x; 
        targetRotationY = (x - 0.5) * Math.PI * 1.5;
    } else {
        status.innerText = "ğŸ“· æ‘„åƒå¤´å·²å¼€å¯ï¼šè¯·å°†å³æ‰‹ä¸¾å…¥ç”»é¢ (æˆ–ä½¿ç”¨é¼ æ ‡ç§»åŠ¨)";
    }
    render();
}

function render() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
    ctx.fillRect(0, 0, width, height);

    // ç»˜åˆ¶ç¦»å±é‡‡æ ·
    const offCanvas = document.createElement('canvas');
    offCanvas.width = width; offCanvas.height = height;
    const octx = offCanvas.getContext('2d');
    octx.fillStyle = "white";
    octx.textAlign = "center";
    octx.textBaseline = "middle";
    const sectionHeight = height / 3;
    const fontSize = Math.min(width / 6, sectionHeight * 0.8);
    octx.font = `900 ${fontSize}px sans-serif`;
    names.forEach((name, i) => {
        octx.fillText(name, width / 2, sectionHeight * i + sectionHeight / 2);
    });

    const pixels = octx.getImageData(0, 0, width, height).data;
    rotationY += (targetRotationY - rotationY) * 0.1;
    hue = (hue + 1) % 360;

    const stepX = 45; 
    const stepY = 18;

    for (let y = 0; y < height; y += stepY) {
        for (let x = 0; x < width; x += stepX) {
            const i = (Math.floor(y) * width + Math.floor(x)) * 4;
            if (pixels[i] > 128) {
                let activeName = names[Math.floor(y / (height / 3.01))];
                ctx.save();
                ctx.translate(width / 2, 0);
                const perspectiveX = (x - width / 2) * Math.cos(rotationY);
                ctx.fillStyle = `hsl(${(hue + y/10) % 360}, 80%, 60%)`;
                ctx.font = "bold 12px monospace";
                ctx.fillText(activeName, perspectiveX, y);
                ctx.restore();
            }
        }
    }
}

// åˆå§‹æ¸²æŸ“ä¸€æ¬¡ï¼ˆä¿è¯é¼ æ ‡èƒ½ç”¨ï¼‰
setInterval(() => { if(!videoActive) render(); }, 30);

const hands = new Hands({
    locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`
});

hands.setOptions({
    maxNumHands: 1,
    modelComplexity: 1,
    minDetectionConfidence: 0.5,
    minTrackingConfidence: 0.5
});
hands.onResults(onResults);

const camera = new Camera(videoElement, {
    onFrame: async () => {
        await hands.send({image: videoElement});
    },
    width: 640,
    height: 480
});

// æ•è·é”™è¯¯ä¿¡æ¯
camera.start().catch(err => {
    status.innerHTML = `<b style="color: #ff4444">æ— æ³•è°ƒç”¨æ‘„åƒå¤´:</b><br>${err}<br><br>ğŸ’¡ è¯·æ£€æŸ¥ GitHub é¡µé¢æƒé™ï¼Œæˆ–æ”¹ç”¨é¼ æ ‡ç§»åŠ¨æµ‹è¯•æ•ˆæœã€‚`;
});
</script>
</body>
</html>
