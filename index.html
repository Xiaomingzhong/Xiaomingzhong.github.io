<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ANN BERRY MARCUS - 手势控制旋转</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; color: white; font-family: sans-serif; }
        canvas { display: block; }
        /* 隐藏原始视频，仅用于后台处理 */
        #input_video { display: none; }
        #status { position: absolute; top: 10px; left: 10px; color: #0f0; z-index: 10; font-size: 12px; }
    </style>
</head>
<body>
    <div id="status">正在启动摄像头并加载模型...</div>
    <video id="input_video"></video>
    <canvas id="output_canvas"></canvas>

<script>
const videoElement = document.getElementById('input_video');
const canvasElement = document.getElementById('output_canvas');
const ctx = canvasElement.getContext('2d');
const status = document.getElementById('status');

const names = ["ANN", "BERRY", "MARCUS"];
let width, height;
let rotationY = 0; // 旋转角度
let targetRotationY = 0;
let lastIndexX = 0.5; // 上次手指位置

function resize() {
    width = canvasElement.width = window.innerWidth;
    height = canvasElement.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// 处理手势结果
function onResults(results) {
    status.innerText = "手势检测中 - 移动右手旋转名字";
    
    // 清空画布
    ctx.clearRect(0, 0, width, height);
    ctx.fillStyle = 'black';
    ctx.fillRect(0, 0, width, height);

    // 检查是否有检测到手
    if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
        // 获取第一只手（通常是右手，MediaPipe会标注左右）
        const landmarks = results.multiHandLandmarks[0];
        const indexFingerTip = landmarks[8]; // 食指尖的关键点索引为 8
        
        // 计算旋转：根据手指在屏幕上的水平位置计算目标角度
        // 这里的 0.5 是中心点，减去它得到偏移量
        targetRotationY = (indexFingerTip.x - 0.5) * Math.PI * 2;
    }

    // 缓动平滑旋转
    rotationY += (targetRotationY - rotationY) * 0.1;

    drawNames();
}

function drawNames() {
    const sectionHeight = height / 3;
    const fontSize = Math.min(width / 6, sectionHeight * 0.7);
    const subFontSize = 14;

    names.forEach((name, i) => {
        const centerY = sectionHeight * i + sectionHeight / 2;
        
        ctx.save();
        ctx.translate(width / 2, centerY);
        
        // 核心旋转逻辑：使用 scale 控制视觉上的水平翻转，模拟旋转
        // 加入 Math.cos(rotationY) 让名字有“变薄-消失-反转”的立体感
        const scale = Math.cos(rotationY);
        ctx.scale(scale, 1);

        // 设置动态色彩
        const hue = (Date.now() / 20 + i * 60) % 360;
        ctx.fillStyle = `hsl(${hue}, 80%, 60%)`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
